{% extends "layout.html" %}

{% block title %}
Graph
{% endblock %}


{% block main %}
<div class="row ">
    <!-- metric option -->
    <div class="col-lg-3 col-md-3 col-sm-12">
        <button class="metric-card rain"><img src="../static/rainfall.png" alt="rainfall" type="submit" height="50px">
            rainFall</button>
    </div>
    <div class="col-lg-3 col-md-3 col-sm-12">
        <button class="metric-card temp"><img src="../static/temp.png" alt="rainfall" type="submit" height="80px">
            Temperature</button>
    </div>
    <div class="col-lg-3 col-md-3 col-sm-12">
        <button class="metric-card ph"><img src="../static/pH.png" alt="rainfall" type="submit" height="50px">
            pH</button>
    </div>

    <!-- graph placeholder -->
    <div class="col-lg-9 col-md-12 col-sm-12 ">
        <canvas id="canvas" class="mt-3"></canvas>
    </div>
</div>

<script>

    let yearly_data;

    fetch('http://127.0.0.1:5000/demographdata')
        .then(res => res.json())
        .then((out) => {
            console.log('Output: ', out);
            yearly_data = out;
        }).catch(err => console.error(err));

    const data = {
        labels: ['Jan', 'Feb', 'Mar', 'Apr'],
        datasets: [] // {'data':..., 'label':...}
    }

    years = Object.keys(yearly_data)
    colors = ['lightblue', 'lightgreen']
    for (let year in yearly_data) {
        metric_value = Object.values(yearly_data[year])
        data["datasets"].push({ data: metric_value, label: year, backgroundColor: colors.pop() })
        console.log(metric_value)
        console.log(year)
    }

    window.onload = function () {
        var ctx = document.getElementById('canvas').getContext('2d');
        window.myBar = new Chart(ctx, {
            type: 'bar',
            data: data,
            options: {
                responsive: true,
                legend: {
                    position: 'bottom',
                },
                title: {
                    display: true,
                    text: 'Temperature'
                }
            }
        });
    };
</script>
{% endblock %}